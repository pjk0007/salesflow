# Plan: 이메일 템플릿 편집기 개선 (email-template-editor)

## 배경 및 문제

현재 이메일 템플릿 편집은 `EmailTemplateDialog` (max-w-2xl 팝업)에서 수행.
- HTML 본문이 `<Textarea rows={12}>`에 raw HTML로 표시되어 **가독성이 매우 낮음**
- AI로 생성한 HTML 본문을 확인/수정하기 어려움
- 결과물이 실제로 어떻게 보이는지 **미리보기 불가**
- 작은 팝업 안에서 복잡한 HTML 편집은 비효율적

## 목표

1. 이메일 템플릿 편집을 **전체화면 다이얼로그**로 확장
2. **좌측: HTML 편집 영역 / 우측: 실시간 미리보기** 2분할 레이아웃
3. HTML 본문을 `contenteditable` 기반 **비주얼 에디터**로 직접 편집 가능
4. 소스코드(HTML) 편집과 비주얼 편집 간 **모드 전환**

## 핵심 요구사항

### R1. 전체화면 편집 레이아웃
- 기존 `max-w-2xl` Dialog → **전체화면 Dialog** (또는 Sheet)
- 좌측: 메타 정보 (이름, 유형, 제목) + AI 패널 + 편집 영역
- 우측: HTML 실시간 미리보기 (iframe/sandbox)

### R2. 듀얼 편집 모드
- **비주얼 모드**: `contenteditable` div에서 WYSIWYG 편집 → HTML 동기화
- **코드 모드**: 기존 `<Textarea>` 방식 (monospace, raw HTML 편집)
- 탭 또는 토글 버튼으로 모드 전환

### R3. 실시간 미리보기
- 우측 패널에 `<iframe srcDoc={htmlBody} sandbox>` 렌더링
- 편집 시 debounce로 미리보기 자동 갱신
- `##변수##` 형태는 하이라이트 또는 placeholder 표시

### R4. AI 생성 연동
- 기존 AiEmailPanel 그대로 활용
- AI 생성 결과 → 편집 영역 + 미리보기에 즉시 반영

### R5. 기존 기능 유지
- 변수 감지 (Badge 표시)
- 저장 / 취소 / 유효성 검증
- template 편집/생성 분기

## 기술 접근

### 전체화면 Dialog
- ShadCN `DialogContent`에 `className="max-w-[95vw] w-full h-[90vh]"` 적용
- 또는 별도 전체화면 Dialog variant 사용

### 비주얼 편집기 (contenteditable)
- `<div contenteditable>` + `dangerouslySetInnerHTML` 초기 로드
- `onInput` 이벤트로 innerHTML 추출 → htmlBody 상태 동기화
- 외부 라이브러리 없이 네이티브 구현 (경량)

### 미리보기
- `<iframe srcDoc={htmlBody} sandbox="allow-same-origin" />`
- 보안: sandbox 속성으로 스크립트 실행 차단
- 반응형: iframe 내부에 viewport meta 포함

## 변경 범위

| # | 파일 | 변경 유형 | 설명 |
|---|------|----------|------|
| 1 | `src/components/email/EmailTemplateDialog.tsx` | **대폭 수정** | 전체화면 레이아웃, 듀얼 편집 모드, 미리보기 패널 |

- 1개 파일만 변경 (EmailTemplateDialog.tsx 내부 리팩토링)
- API, DB, 훅 변경 없음
- 다른 컴포넌트에서 호출하는 인터페이스(Props) 변경 없음

## UI 레이아웃 구상

```
┌──────────────────────────────────────────────────────────────────────┐
│ 📧 새 템플릿 / 템플릿 편집                       [AI] [취소] [저장] │
├──────────────────────────────┬───────────────────────────────────────┤
│  이름: [____________]        │                                       │
│  유형: [____________]        │           미리보기                     │
│  제목: [____________]        │                                       │
│                              │   ┌─────────────────────────────┐     │
│  [AI 패널 (접이식)]          │   │                             │     │
│                              │   │  <h1>환영합니다!</h1>       │     │
│  [비주얼] [코드]             │   │  <p>내용이 여기에...</p>    │     │
│  ┌────────────────────────┐  │   │                             │     │
│  │                        │  │   │                             │     │
│  │  편집 영역              │  │   └─────────────────────────────┘     │
│  │  (contenteditable      │  │                                       │
│  │   또는 textarea)       │  │   감지된 변수: [name] [company]       │
│  │                        │  │                                       │
│  └────────────────────────┘  │                                       │
└──────────────────────────────┴───────────────────────────────────────┘
```

## 비대상 (Scope 외)

- 리치 텍스트 에디터 라이브러리 도입 (TipTap, Quill 등) — 과도한 의존성
- 드래그앤드롭 블록 에디터 — 복잡도 과다
- 이메일 템플릿 갤러리/마켓 — 별도 기능

## 검증

- `pnpm build` 성공
- 기존 이메일 템플릿 CRUD 정상 동작
- AI 생성 → 편집 영역 반영 확인
- 비주얼/코드 모드 전환 시 내용 동기화
- 미리보기 실시간 갱신 확인
